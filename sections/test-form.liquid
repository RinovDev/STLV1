{% schema %}
  {
    "name": "Dynamic Contact Form",
    "settings": [],
    "blocks": [
      {
        "type": "text",
        "name": "Text Field",
        "settings": [
          {
            "type": "text",
            "id": "label",
            "label": "Label",
            "default": "Text Field"
          },
          {
            "type": "text",
            "id": "id",
            "label": "Field ID",
            "default": "text_field"
          }
        ]
      },
      {
        "type": "image",
        "name": "Image Upload",
        "settings": [
          {
            "type": "text",
            "id": "label",
            "label": "Label",
            "default": "Upload Image"
          },
          {
            "type": "text",
            "id": "id",
            "label": "Field ID",
            "default": "image_field"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Default",
        "category": "Custom Forms"
      }
    ]
  }
  {% endschema %}

<div class="contact-form-container">
  <h2>Contact Us</h2>
  <form class="contact-form-server" action="http://localhost:3001/upload" method="POST" enctype="multipart/form-data">
    {% for block in section.blocks %}
      {% if block.type == 'text_field' %}
        <label for="text_{{ block.id }}">{{ block.settings.label }}</label>
        <input type="text" id="text_{{ block.id }}" name="text_{{ block.id }}" required>
      {% elsif block.type == 'image_field' %}
        <label for="image_{{ block.id }}">{{ block.settings.label }}</label>
        <input type="file" id="image_{{ block.id }}" name="images[]" accept="image/png, image/jpeg" multiple required>
      {% endif %}
    {% endfor %}
    <button type="submit">Submit</button>
  </form>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.contact-form-server');
    const inputs = form.querySelectorAll('input[type="text"], input[type="file"]');
    inputs.forEach(input => {
      const newId = input.id + '_' + Date.now() + Math.random().toString(36).substr(2, 9);
      const label = form.querySelector('label[for="' + input.id + '"]');
      if (label) {
        label.htmlFor = newId;
      }
      input.id = newId;
    });
  });
</script>
  
  <style>
    .contact-form-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .contact-form {
      display: flex;
      flex-direction: column;
    }
    .contact-form .form-field {
      margin-bottom: 15px;
    }
    .contact-form label {
      margin-bottom: 5px;
      font-weight: bold;
    }
    .contact-form input[type="text"],
    .contact-form input[type="file"] {
      margin-bottom: 15px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .contact-form button {
      padding: 10px 20px;
      font-size: 18px;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .contact-form button:hover {
      background-color: #0056b3;
    }
  </style>
  